# 弁護士基準計算システム & CarScan Pro

## 概要
このリポジトリには2つの主要なプロジェクトが含まれています：

### 1. 弁護士基準計算システム
交通事故の損害額計算を弁護士基準で行うPythonアプリケーション。
詳細は [弁護士基準計算システムREADME](README_弁護士基準計算システム.md) をご参照ください。

### 2. CarScan Pro - 高度動画解析ツール
MP4動画ファイルから車両の寸法測定、軌跡追跡、速度分析、進路分析を行う高度な動画解析ツール。
詳細は [CarScan Pro README](README_CarScan.md) をご参照ください。

## プロジェクト構成

### 弁護士基準計算システム
```
├── main.py                    # メインアプリケーション
├── ui/                        # ユーザーインターフェース
├── calculation/               # 計算エンジン
├── database/                  # データベース管理
├── reports/                   # レポート生成
└── tests/                     # テストスイート
```

### CarScan Pro
```
src/
├── index.html                 # メインHTMLファイル
├── test.html                  # 動作テストページ
├── css/
│   └── styles.css         # スタイルシート
└── js/
    ├── globals.js         # グローバル変数管理
    ├── dom-elements.js    # DOM要素取得
    ├── core/
    │   ├── app.js         # メインアプリケーション
    │   ├── mode-manager.js # モード管理
    │   └── video-handler.js # 動画処理
    ├── analysis/
    │   ├── dimension.js   # 寸法測定機能
    │   └── oncoming.js    # 対向車分析機能
    ├── components/
    │   ├── zoom-pan.js    # ズーム・パン機能
    │   └── ai-comment.js  # AIコメント機能
    └── utils/
        ├── math.js        # 数学計算ユーティリティ
        ├── ui.js          # UI操作ユーティリティ
        └── canvas.js      # キャンバス描画ユーティリティ
```

### レガシー版
- `carscan.html` - 単一ファイル版（924行、参照用）

## 使用方法

### 1. 動画の読み込み
1. ブラウザで `src/index.html` を開く（または `carscan.html` を開く）
2. 「MP4ファイルを選択」からMP4動画ファイルを選択
3. 動画が読み込まれ、分析モード選択画面が表示される

### 2. 分析モードの選択
4つの分析モードから選択：
- 📏 **寸法測定**: 物体の実際のサイズを測定
- 🚗 **進路分析**: 車両の角度変化を分析
- ⚡ **速度解析**: 車両の移動速度を計算
- 📈 **軌跡追跡**: 複数車両の軌跡を記録

### 3. 分析の実行
各モードの指示に従って：
- 動画を一時停止
- 分析対象をクリックで指定
- 参照値やパラメータを入力
- 結果の確認とエクスポート

## インストール・セットアップ

### 必要な環境
- モダンなウェブブラウザ（Chrome、Firefox、Safari、Edge）
- JavaScript有効化
- インターネット接続（CDNライブラリ使用のため）

### ローカル実行
```bash
# リポジトリをクローン
git clone https://github.com/sakurasaku1213/carscan.git

# ディレクトリに移動
cd carscan

# ブラウザでHTMLファイルを開く
# または、ローカルサーバーを起動（推奨）
python -m http.server 8000
# ブラウザで http://localhost:8000/carscan.html にアクセス
```

## 使用例

### 寸法測定の例
1. 車両の動画を読み込む
2. 寸法測定モードを選択
3. 既知のサイズの参照物（標識、車線幅など）を指定
4. 測定したい車両部分を指定
5. 実寸サイズが自動計算される

### 速度分析の例
1. 車両が移動する動画を読み込む
2. 速度解析モードを選択
3. 既知の距離（車線幅、標識間距離など）を設定
4. 車両の移動開始点と終了点を指定
5. 速度が km/h で表示される

## 対応ファイル形式
- **動画**: MP4形式
- **エクスポート**: JSON、CSV形式

## ブラウザ対応
- Chrome 88+
- Firefox 85+
- Safari 14+
- Edge 88+

## 貢献・開発

### リファクタリングの効果
- **コードベース**: 924行の単一ファイルから15個のモジュールに分離
- **保守性**: 機能別に分割され、テストやデバッグが容易
- **拡張性**: 新機能の追加や既存機能の修正が安全に実行可能
- **可読性**: JSDocコメントと明確な責任範囲による高い可読性

### モジュール構成
- **Core**: アプリケーションの中核機能
- **Analysis**: 分析アルゴリズム（寸法測定、対向車分析）
- **Components**: UI コンポーネント（ズーム、AIコメント）
- **Utils**: 共通ユーティリティ（数学計算、UI操作、キャンバス描画）

### テスト
- `src/test.html` でリファクタリング後のモジュール読み込みテストが可能
- 各モジュールが正常に読み込まれ、関数が定義されているかを確認

### 機能追加・改善案
- [ ] 他の動画形式対応（WebM、MOV等）
- [ ] より高度な軌跡予測アルゴリズム
- [ ] 3D分析機能
- [ ] レポート生成機能
- [ ] データベース連携

### バグ報告・機能要望
GitHubのIssuesページでお気軽にご報告ください。

## ライセンス
MIT License

## 作者
sakurasaku1213

## 更新履歴
- v1.1.0 (2025-05-28): リファクタリング完了
  - 924行の単一ファイルを15個のモジュールに分離
  - 保守性・拡張性・可読性の大幅向上
  - テストページ追加（test.html）
  - モジュール別のJSDoc追加
- v1.0.0 (2025-05-28): 初回リリース
  - 基本的な4つの分析モード実装
  - レスポンシブデザイン対応
  - データエクスポート機能

---

**注意**: このツールは分析・研究目的で作成されました。分析結果の正確性については、使用者の責任で検証してください。
=======
# 弁護士基準損害賠償計算システム v2.0

## 概要

このシステムは、交通事故等の損害賠償計算を弁護士基準で自動化する専門的なアプリケーションです。モダンなGUIインターフェースを提供し、正確で効率的な損害賠償計算を支援します。

## 主な機能

### 📊 損害賠償計算
- **弁護士基準による正確な計算**: 業界標準の計算式を使用
- **リアルタイム計算**: 入力値の変更に応じて即座に結果を更新
- **包括的な損害項目**: 治療費、慰謝料、逸失利益等を網羅

### 💼 案件管理
- **案件データベース**: SQLiteによる安全なデータ保存
- **案件履歴管理**: 過去の計算結果の検索・参照
- **データエクスポート**: PDF・Excel形式での出力

### 🎨 ユーザーインターフェース
- **モダンなUI**: CustomTkinterによる美しいインターフェース
- **直感的操作**: ユーザーフレンドリーなデザイン
- **レスポンシブ設計**: 様々な画面サイズに対応

### 🔒 セキュリティ・安定性
- **統合エラーハンドリング**: 堅牢なエラー処理システム
- **パフォーマンス監視**: リアルタイムシステム監視
- **セキュリティ管理**: データの安全性確保

## 最新の改善事項 (v2.0)

### 🎯 ユーザーエクスペリエンス向上
- **入力時エラー表示の改善**: 案件番号・依頼者氏名入力時の即座エラー表示を抑制
- **スマートな入力制御**: `auto_calculate`機能による柔軟な入力制御
- **作業効率向上**: ストレスフリーな入力環境の実現

### 🔧 システム安定性向上
- **循環インポート問題の解決**: モジュール間の依存関係を最適化
- **モデル統一**: データモデルの一貫性確保
- **エラー処理強化**: より堅牢なエラーハンドリング

## システム要件

### 動作環境
- **OS**: Windows 10/11
- **Python**: 3.8以上
- **メモリ**: 4GB以上推奨
- **ストレージ**: 500MB以上の空き容量

### 必要パッケージ
```
customtkinter>=5.0.0
tkinter
sqlite3
pandas
openpyxl
reportlab
pillow
python-dateutil
decimal
```

## インストール

### 1. リポジトリのクローン
```bash
git clone https://github.com/[your-username]/lawyer-compensation-calculator.git
cd lawyer-compensation-calculator
```

### 2. 仮想環境の作成（推奨）
```bash
python -m venv venv
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate
```

### 3. 依存関係のインストール
```bash
pip install -r requirements.txt
```

### 4. アプリケーションの起動
```bash
python main.py
```

## 使用方法

### 基本的な操作手順

1. **新規案件の作成**
   - アプリケーション起動後、「新規案件」ボタンをクリック
   - 案件番号と依頼者氏名を入力

2. **基本情報の入力**
   - 被害者情報（年齢、職業、年収等）
   - 事故情報（事故日、症状固定日等）
   - 治療情報（治療期間、治療費等）

3. **計算結果の確認**
   - 入力内容に基づいて自動計算される損害賠償額を確認
   - 各項目の詳細な内訳を参照

4. **結果の保存・出力**
   - 計算結果をデータベースに保存
   - PDF・Excel形式でのレポート出力

## プロジェクト構造

```
lawyer-compensation-calculator/
├── main.py                     # メインアプリケーション
├── requirements.txt            # 依存関係
├── README.md                  # このファイル
├── COMPLETION_REPORT.md       # 実装完了報告
│
├── ui/                        # ユーザーインターフェース
│   └── modern_calculator_ui.py
│
├── models/                    # データモデル
│   ├── __init__.py
│   └── case_data.py
│
├── database/                  # データベース管理
│   ├── __init__.py
│   └── db_manager.py
│
├── calculation/               # 計算エンジン
│   ├── __init__.py
│   └── compensation_engine.py
│
├── config/                    # 設定管理
│   ├── __init__.py
│   ├── app_config.py
│   └── app_config.json
│
├── utils/                     # ユーティリティ
│   ├── __init__.py
│   ├── error_handler.py
│   ├── performance_monitor.py
│   └── security_manager.py
│
├── reports/                   # レポート生成
│   ├── __init__.py
│   ├── pdf_generator.py
│   └── excel_generator.py
│
└── tests/                     # テストファイル
    └── test_functionality.py
```

## 開発

### 開発環境のセットアップ
1. 上記のインストール手順を実行
2. 開発用の追加パッケージをインストール：
   ```bash
   pip install pytest pytest-cov black flake8
   ```

### テストの実行
```bash
python -m pytest tests/
```

### コードフォーマット
```bash
black . --line-length 100
```

## 貢献

プルリクエストや課題報告を歓迎します。貢献する前に、以下をご確認ください：

1. コードスタイルガイドラインに従う
2. 適切なテストを追加する
3. ドキュメントを更新する

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。詳細は`LICENSE`ファイルを参照してください。

## 変更履歴

### v2.0 (2025-05-27)
- ✨ 入力時エラー表示の改善
- 🔧 システム安定性向上
- 🐛 循環インポート問題の解決
- 📈 ユーザーエクスペリエンス向上

### v1.0 (初期バージョン)
- 基本的な損害賠償計算機能
- データベース連携
- PDF・Excel出力機能

## サポート

質問や問題がございましたら、GitHubのIssuesページにてお気軽にお問い合わせください。

---

**開発**: 法務システム開発チーム  
**最終更新**: 2025年5月27日
>>>>>>> 3db71bb6ea19a47bc1a4ef36f7b3e867e551e562
