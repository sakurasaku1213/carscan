# CarScan Pro - 高度動画解析ツール

## 概要
CarScan Proは、MP4動画ファイルから車両の寸法測定、軌跡追跡、速度分析、進路分析を行う高度な動画解析ツールです。ウェブブラウザ上で動作し、直感的なインターフェースで専門的な分析が可能です。

## 主な機能

### 🔍 寸法測定モード
- 参照オブジェクトを使用した高精度な寸法測定
- リアルタイムスケール計算
- AIによる測定結果コメント生成

### 🚗 対向車進路分析モード
- 2フレーム間での車両角度変化の計算
- 進路変更の検出と定量化
- 時間差を考慮した詳細分析

### ⚡ 速度解析モード
- 参照距離を使用した速度計算
- 平均速度と最大速度の表示
- 速度変化のグラフ表示

### 📈 軌跡追跡モード
- 複数車両の同時追跡（最大4台）
- リアルタイム軌跡表示
- 軌跡データのエクスポート機能

## 技術仕様

### フロントエンド
- **HTML5** - セマンティックマークアップ
- **CSS3** - TailwindCSS使用、レスポンシブデザイン
- **JavaScript** - バニラJS、Canvas API使用
- **Chart.js** - データ可視化

### 主要技術
- HTML5 Canvas API
- HTML5 Video API
- File API
- レスポンシブWebデザイン
- インタラクティブUI/UX

## ファイル構造

### リファクタリング版（推奨）
```
src/
├── index.html              # メインHTMLファイル
├── test.html              # 動作テストページ
├── css/
│   └── styles.css         # スタイルシート
└── js/
    ├── globals.js         # グローバル変数管理
    ├── dom-elements.js    # DOM要素取得
    ├── core/
    │   ├── app.js         # メインアプリケーション
    │   ├── mode-manager.js # モード管理
    │   └── video-handler.js # 動画処理
    ├── analysis/
    │   ├── dimension.js   # 寸法測定機能
    │   └── oncoming.js    # 対向車分析機能
    ├── components/
    │   ├── zoom-pan.js    # ズーム・パン機能
    │   └── ai-comment.js  # AIコメント機能
    └── utils/
        ├── math.js        # 数学計算ユーティリティ
        ├── ui.js          # UI操作ユーティリティ
        └── canvas.js      # キャンバス描画ユーティリティ
```

### レガシー版
- `carscan.html` - 単一ファイル版（924行、参照用）

## 使用方法

### 1. 動画の読み込み
1. ブラウザで `src/index.html` を開く（または `carscan.html` を開く）
2. 「MP4ファイルを選択」からMP4動画ファイルを選択
3. 動画が読み込まれ、分析モード選択画面が表示される

### 2. 分析モードの選択
4つの分析モードから選択：
- 📏 **寸法測定**: 物体の実際のサイズを測定
- 🚗 **進路分析**: 車両の角度変化を分析
- ⚡ **速度解析**: 車両の移動速度を計算
- 📈 **軌跡追跡**: 複数車両の軌跡を記録

### 3. 分析の実行
各モードの指示に従って：
- 動画を一時停止
- 分析対象をクリックで指定
- 参照値やパラメータを入力
- 結果の確認とエクスポート

## インストール・セットアップ

### 必要な環境
- モダンなウェブブラウザ（Chrome、Firefox、Safari、Edge）
- JavaScript有効化
- インターネット接続（CDNライブラリ使用のため）

### ローカル実行
```bash
# リポジトリをクローン
git clone https://github.com/sakurasaku1213/carscan.git

# ディレクトリに移動
cd carscan

# ブラウザでHTMLファイルを開く
# または、ローカルサーバーを起動（推奨）
python -m http.server 8000
# ブラウザで http://localhost:8000/carscan.html にアクセス
```

## 使用例

### 寸法測定の例
1. 車両の動画を読み込む
2. 寸法測定モードを選択
3. 既知のサイズの参照物（標識、車線幅など）を指定
4. 測定したい車両部分を指定
5. 実寸サイズが自動計算される

### 速度分析の例
1. 車両が移動する動画を読み込む
2. 速度解析モードを選択
3. 既知の距離（車線幅、標識間距離など）を設定
4. 車両の移動開始点と終了点を指定
5. 速度が km/h で表示される

## 対応ファイル形式
- **動画**: MP4形式
- **エクスポート**: JSON、CSV形式

## ブラウザ対応
- Chrome 88+
- Firefox 85+
- Safari 14+
- Edge 88+

## 貢献・開発

### リファクタリングの効果
- **コードベース**: 924行の単一ファイルから15個のモジュールに分離
- **保守性**: 機能別に分割され、テストやデバッグが容易
- **拡張性**: 新機能の追加や既存機能の修正が安全に実行可能
- **可読性**: JSDocコメントと明確な責任範囲による高い可読性

### モジュール構成
- **Core**: アプリケーションの中核機能
- **Analysis**: 分析アルゴリズム（寸法測定、対向車分析）
- **Components**: UI コンポーネント（ズーム、AIコメント）
- **Utils**: 共通ユーティリティ（数学計算、UI操作、キャンバス描画）

### テスト
- `src/test.html` でリファクタリング後のモジュール読み込みテストが可能
- 各モジュールが正常に読み込まれ、関数が定義されているかを確認

### 機能追加・改善案
- [ ] 他の動画形式対応（WebM、MOV等）
- [ ] より高度な軌跡予測アルゴリズム
- [ ] 3D分析機能
- [ ] レポート生成機能
- [ ] データベース連携

### バグ報告・機能要望
GitHubのIssuesページでお気軽にご報告ください。

## ライセンス
MIT License

## 作者
sakurasaku1213

## 更新履歴
- v1.1.0 (2025-05-28): リファクタリング完了
  - 924行の単一ファイルを15個のモジュールに分離
  - 保守性・拡張性・可読性の大幅向上
  - テストページ追加（test.html）
  - モジュール別のJSDoc追加
- v1.0.0 (2025-05-28): 初回リリース
  - 基本的な4つの分析モード実装
  - レスポンシブデザイン対応
  - データエクスポート機能

---

**注意**: このツールは分析・研究目的で作成されました。分析結果の正確性については、使用者の責任で検証してください。
